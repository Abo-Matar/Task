<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team Task List</title>

<style>
body { font-family: Arial; margin: 10px; }
h2 { text-align: center; }

button {
  padding: 8px 12px;
  background: #007BFF;
  color: #fff;
  border: none;
  border-radius: 4px;
  margin-bottom: 10px;
}

#filter {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

th, td {
  border: 1px solid #aaa;
  padding: 0;
}

th {
  background: #f2f2f2;
  cursor: pointer;
}

td input, td select {
  width: 100%;
  height: 100%;
  padding: 6px;
  border: none;
  box-sizing: border-box;
  font-size: 13px;
}

tbody tr:nth-child(even) { background: #f9f9f9; }
</style>
</head>

<body>

<h2>Team Task List</h2>
<button onclick="addTask()">Add Task</button>
<input id="filter" type="text" placeholder="Filter..." onkeyup="filterTable()">

<table id="taskTable">
  <colgroup>
    <col style="width:6%">
    <col style="width:6%">
    <col style="width:4%">
    <col style="width:10%">
    <col style="width:6%">
    <col style="width:13%">
    <col style="width:6%">
  </colgroup>

  <thead>
    <tr>
      <th onclick="sortBy('date')">Date</th>
      <th onclick="sortBy('task')">Task</th>
      <th onclick="sortBy('responsible')">Responsible</th>
      <th onclick="sortBy('communication')">Communication</th>
      <th onclick="sortBy('due')">Due Date</th>
      <th onclick="sortBy('remarks')">Remarks</th>
      <th onclick="sortBy('status')">Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const statusOptions = ['Assigned','Started','On Hold','Delay','Completed'];
let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
let sortState = { column: null, asc: true };

renderTable();

/* ===== UPDATE SINGLE FIELD ===== */
function updateTask(index, field, value) {
  tasks[index][field] = value;
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

/* ===== ADD TASK ===== */
function addTask() {
  // delete completed ONLY here
  tasks = tasks.filter(t => t.status !== 'Completed');

  const today = new Date().toISOString().split('T')[0];
  tasks.unshift({
    date: today,
    task: '',
    responsible: '',
    communication: '',
    due: today,
    remarks: '',
    status: 'Assigned'
  });

  localStorage.setItem('tasks', JSON.stringify(tasks));
  renderTable();
}

/* ===== SORTING ===== */
function sortBy(column) {
  if (sortState.column === column) {
    sortState.asc = !sortState.asc;
  } else {
    sortState.column = column;
    sortState.asc = true;
  }

  tasks.sort((a, b) => {
    const v1 = (a[column] || '').toString().toLowerCase();
    const v2 = (b[column] || '').toString().toLowerCase();
    return sortState.asc ? v1.localeCompare(v2) : v2.localeCompare(v1);
  });

  renderTable();
}

/* ===== RENDER ===== */
function renderTable() {
  const tb = document.querySelector('#taskTable tbody');
  tb.innerHTML = '';

  tasks.forEach((t, i) => {
    const r = tb.insertRow();
    r.innerHTML = `
      <td><input type="date" value="${t.date}" onchange="updateTask(${i},'date',this.value)"></td>
      <td><input value="${t.task}" onchange="updateTask(${i},'task',this.value)"></td>
      <td><input value="${t.responsible}" onchange="updateTask(${i},'responsible',this.value)"></td>
      <td><input value="${t.communication}" onchange="updateTask(${i},'communication',this.value)"></td>
      <td><input type="date" value="${t.due}" onchange="updateTask(${i},'due',this.value)"></td>
      <td><input value="${t.remarks}" onchange="updateTask(${i},'remarks',this.value)"></td>
      <td>
        <select onchange="updateTask(${i},'status',this.value)">
          ${statusOptions.map(s =>
            `<option value="${s}" ${s===t.status?'selected':''}>${s}</option>`
          ).join('')}
        </select>
      </td>`;
  });
}

/* ===== FILTER ===== */
function filterTable() {
  const f = filter.value.toLowerCase();
  [...document.querySelectorAll('#taskTable tbody tr')].forEach(r => {
    r.style.display = [...r.querySelectorAll('input,select')]
      .some(el => el.value.toLowerCase().includes(f)) ? '' : 'none';
  });
}
</script>

</body>
</html>
